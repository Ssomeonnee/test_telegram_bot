<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Таблица с закрепленным столбцом</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-webapp.js"></script>
    <style>
        body {
            overflow-x: auto;
            touch-action: manipulation;
            -webkit-text-size-adjust: 100%;
        }
        

        .header {
            background-color: #f8f9fa;
            padding: 10px;
            text-align: center;
            margin-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        

        .header-title {
            margin: 0;
            text-align: left;
        }

        .table-container {
            overflow: auto;
            height: calc(100vh - 100px);
            -webkit-overflow-scrolling: touch;
            background-color: white;
        }
        

        .main-table {
            table-layout: fixed;
            width: auto;
            min-width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        

        .main-table th,
        .main-table td {
            border: 1px solid #dee2e6 !important;
@@ -51,7 +58,7 @@
            background-color: white;
            position: relative;
        }
        

        /* Закрепленный столбец с фамилиями */
        .main-table th:first-child,
        .main-table td:first-child {
@@ -64,80 +71,82 @@
            background-color: #f1f8ff;
            border-right: 2px solid #b3d1ff !important;
        }
        

        /* Закрепленный заголовок первого столбца */
        .main-table th:first-child {
            z-index: 22;
            top: 0;
        }
        

        /* Остальные ячейки */
        .main-table th:not(:first-child),
        .main-table td:not(:first-child) {
            width: 40px;
            min-width: 40px;
            max-width: 40px;
        }
        
        /* Заголовки */
        .main-table th {
            background-color: #f8f9fa;
            position: sticky;
            top: 0;
            z-index: 20;
        }
        

        /* Hover эффект для строк - переделан для мобильных */
        .main-table tbody tr {
            transition: background-color 0.1s;
        }

        .main-table tbody tr:hover td,
        .main-table tbody tr.highlight td {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .main-table tbody tr:hover td:first-child,
        .main-table tbody tr.highlight td:first-child {
            background-color: #e1f0ff;
        }
        

        /* Гарантируем отображение границ */
        .main-table th:last-child,
        .main-table td:last-child {
            border-right: 1px solid #dee2e6 !important;
        }
        

        /* Стиль для редактируемой ячейки */
        .editable-cell {
            cursor: pointer;
        }

        .editable-cell:focus {
            outline: 2px solid #0d6efd;
            background-color: #fff;
            z-index: 30;
        }
        

        /* Для мобильных устройств */
        @media (max-width: 576px) {
            .main-table th,
            .main-table td {
                font-size: 12px;
                padding: 4px;
            }
            

            .main-table th:not(:first-child),
            .main-table td:not(:first-child) {
                width: 30px;
                min-width: 30px;
                max-width: 30px;
            }
            

            .main-table th:first-child,
            .main-table td:first-child {
                width: 80px;
                min-width: 80px;
                max-width: 80px;
            }
            

            /* Улучшение для touch-устройств */
            .main-table {
                -webkit-transform: translate3d(0,0,0);
@@ -147,107 +156,226 @@
    </style>
</head>
<body>
    <div class="container-fluid p-0">
        <div class="header">
            <h5 class="m-0">Файл Главная</h5>
            <div class="header-actions">
        <button class="btn btn-primary save-button">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-save" viewBox="0 0 16 16">
              <path d="M11 5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1V5zm-6 1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1H5z"/>
            </svg>
            Сохранить
        </button>
    </div>
<div class="container-fluid p-0">
    <div class="header">
        <h5 class="m-0 header-title">Файл Главная</h5>
        <div class="header-actions">
            <button class="btn btn-primary save-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-save" viewBox="0 0 16 16">
                    <path d="M11 5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1V5zm-6 1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1H5z"/>
                </svg>
                Сохранить
            </button>
        </div>
        
        <div class="table-container">
            <table class="table main-table">
                <thead>
                    <tr id="table-header">
                        <!-- Заголовки будут добавлены через JS -->
                    </tr>
                </thead>
                <tbody id="table-body">
                    <!-- Строки будут добавлены через JS -->
                </tbody>
            </table>
    </div>

    <div class="table-container">
        <table class="table main-table">
            <thead>
            <tr id="table-header">
                <!-- Заголовки будут добавлены через JS -->
            </tr>
            </thead>
            <tbody id="table-body">
            <!-- Строки будут добавлены через JS -->
            </tbody>
        </table>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Получаем данные из URL
        const urlParams = new URLSearchParams(window.location.search);
        const encodedData = urlParams.get('data');

        if (encodedData) {
            try {
                const decodedData = atob(decodeURIComponent(encodedData)); // Декодируем Base64
                const webAppData = JSON.parse(decodedData);

                const scheduleId = webAppData.schedule_id;
                const month = webAppData.month;
                const year = webAppData.year;
                const daysInMonth = webAppData.days;
                const employees = webAppData.employees;
                const duties = webAppData.duties;

                // Обновляем заголовок
                document
        /* Заголовки */
        .main-table th {
            background-color: #f8f9fa;
            position: sticky;
            top: 0;
            z-index: 20;
        }

        /* Hover эффект для строк - переделан для мобильных */
        .main-table tbody tr {
            transition: background-color 0.1s;
        }

        .main-table tbody tr:hover td,
        .main-table tbody tr.highlight td {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .main-table tbody tr:hover td:first-child,
        .main-table tbody tr.highlight td:first-child {
            background-color: #e1f0ff;
        }

        /* Гарантируем отображение границ */
        .main-table th:last-child,
        .main-table td:last-child {
            border-right: 1px solid #dee2e6 !important;
        }

        /* Стиль для редактируемой ячейки */
        .editable-cell {
            cursor: pointer;
        }

        .editable-cell:focus {
            outline: 2px solid #0d6efd;
            background-color: #fff;
            z-index: 30;
        }

        /* Для мобильных устройств */
        @media (max-width: 576px) {
            .main-table th,
            .main-table td {
                font-size: 12px;
                padding: 4px;
            }

            .main-table th:not(:first-child),
            .main-table td:not(:first-child) {
                width: 30px;
                min-width: 30px;
                max-width: 30px;
            }

            .main-table th:first-child,
            .main-table td:first-child {
                width: 80px;
                min-width: 80px;
                max-width: 80px;
            }

            /* Улучшение для touch-устройств */
            .main-table {
                -webkit-transform: translate3d(0,0,0);
                transform: translate3d(0,0,0);
            }
        }
    </style>
</head>
<body>
<div class="container-fluid p-0">
    <div class="header">
        <h5 class="m-0 header-title">Файл Главная</h5>
        <div class="header-actions">
            <button class="btn btn-primary save-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-save" viewBox="0 0 16 16">
                    <path d="M11 5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1V5zm-6 1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1H5z"/>
                </svg>
                Сохранить
            </button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    <div class="table-container">
        <table class="table main-table">
            <thead>
            <tr id="table-header">
                <!-- Заголовки будут добавлены через JS -->
            </tr>
            </thead>
            <tbody id="table-body">
            <!-- Строки будут добавлены через JS -->
            </tbody>
        </table>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Получаем данные из URL
        const urlParams = new URLSearchParams(window.location.search);
        const encodedData = urlParams.get('data');
    

        if (encodedData) {
            try {
                const decodedData = atob(decodeURIComponent(encodedData)); // Декодируем Base64
                const webAppData = JSON.parse(decodedData);
    

                const scheduleId = webAppData.schedule_id;
                const month = webAppData.month;
                const year = webAppData.year;
                const daysInMonth = webAppData.days;
                const employees = webAppData.employees;
                const duties = webAppData.duties;
    

                // Обновляем заголовок
                document.querySelector('.header h5').textContent = `График на ${month} ${year}`;
    

                // Формируем заголовки дней
                const dayHeaders = ['Фамилия'];
                for (let day = 1; day <= daysInMonth; day++) {
                    dayHeaders.push(day.toString());
                }
    

                // Конфигурация таблицы
                const config = {
                    rowsCount: employees.length,
                    colsCount: daysInMonth,
                    fixedColumnData: employees,
                    mainHeaderData: dayHeaders
                };
    

                // Создаем заголовок таблицы
                const tableHeader = document.getElementById('table-header');
                config.mainHeaderData.forEach(item => {
                    const th = document.createElement('th');
                    th.textContent = item;
                    tableHeader.appendChild(th);
                });
    

                // Создаем тело таблицы и заполняем данными о дежурствах
                const tableBody = document.getElementById('table-body');
                employees.forEach(employee => {
                    const row = document.createElement('tr');
    

                    // Ячейка с именем сотрудника
                    const nameTd = document.createElement('td');
                    nameTd.textContent = employee.full_name;  // Use full_name
                    row.appendChild(nameTd);
    

                    // Ячейки с днями месяца
                    for (let day = 1; day <= daysInMonth; day++) {
                        const td = document.createElement('td');
                        td.classList.add('editable-cell'); // Add class
                        td.setAttribute('contenteditable', 'true'); // Make editable
    

                        const duty = duties.find(d => d.employee_id === employee.id && d.day === day); //Compare numbers
                        if (duty) {
                            td.textContent = duty.title;
                            td.style.backgroundColor = '#e6f7ff';
                        } else {
                            td.textContent = ''; // Пустые ячейки по умолчанию
                        }
    

                        row.appendChild(td);
                    }
    

                    tableBody.appendChild(row);
                });
    

                // Функция для сбора данных о дежурствах и отправки их боту
                function sendTableData() {
                    const dutiesToSend = [];
@@ -263,32 +391,26 @@
                            }
                        }
                    });
    

                    const data = {
                        schedule_id: scheduleId,
                        duties: dutiesToSend
                    };
    

                    Telegram.WebApp.sendData(JSON.stringify(data));
                }
    

                // Кнопка для отправки данных
                const sendButton = document.createElement('button');
                sendButton.textContent = 'Сохранить и отправить';
                sendButton.classList.add('btn', 'btn-primary');
                const sendButton = document.querySelector('.save-button'); // Select existing button
                sendButton.addEventListener('click', sendTableData);
                document.querySelector('.header').appendChild(sendButton);
    

            } catch (error) {
                console.error("Ошибка декодирования или обработки данных:", error);
            }
        } else {
            console.warn("Данные не найдены в URL.");
        }
    });
    </script>
</script>
</body>
</html>
