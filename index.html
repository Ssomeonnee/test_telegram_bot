<!DOCTYPE html>
<html>
<head>
    <title>Telegram Web App Test</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { padding: 10px 20px; font-size: 16px; }
        #status { margin-top: 20px; padding: 10px; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <h1>Telegram Web App Test</h1>
    <button onclick="sendData()">Send Data to Bot</button>
    <div id="status">Status: Ready</div>

    <script>
        let tg = null;
        
        // Инициализация Web App
        document.addEventListener('DOMContentLoaded', function() {
            const statusDiv = document.getElementById('status');
            
            if (window.Telegram && window.Telegram.WebApp) {
                tg = Telegram.WebApp;
                statusDiv.innerHTML = 'Status: Telegram Web App available';
                statusDiv.style.color = 'green';
                
                console.log("Telegram Web App initialized");
                console.log("Version:", tg.version);
                console.log("Platform:", tg.platform);
                console.log("InitData:", tg.initData);
                
                tg.ready();
                tg.expand();
                
                // Добавляем обработчики событий
                tg.onEvent('viewportChanged', function(e) {
                    console.log('Viewport changed:', e);
                });
                
                tg.onEvent('themeChanged', function() {
                    console.log('Theme changed');
                });
                
            } else {
                statusDiv.innerHTML = 'Status: NOT in Telegram environment';
                statusDiv.style.color = 'red';
                
                console.log("Running outside Telegram - simulation mode");
                
                // Симуляция для отладки
                tg = {
                    sendData: function(data) {
                        console.log("Simulated sendData:", data);
                        alert("Simulated data sent: " + data);
                        statusDiv.innerHTML = 'Status: Data sent (simulated)';
                    },
                    ready: function() { console.log("Simulated ready"); },
                    close: function() { console.log("Simulated close"); },
                    expand: function() { console.log("Simulated expand"); }
                };
            }
        });

        function sendData() {
            const statusDiv = document.getElementById('status');
            
            try {
                if (tg && tg.sendData) {
                    const data = { 
                        message: "Hello from Web App!",
                        timestamp: new Date().toISOString(),
                        user: tg.initDataUnsafe?.user?.username || 'unknown'
                    };
                    
                    console.log("Sending data:", data);
                    statusDiv.innerHTML = 'Status: Sending data...';
                    
                    // Отправляем данные
                    tg.sendData(JSON.stringify(data));
                    
                    statusDiv.innerHTML = 'Status: Data sent successfully!';
                    statusDiv.style.color = 'green';
                    
                    console.log("Data sent successfully");
                    
                } else {
                    statusDiv.innerHTML = 'Status: Web App not available';
                    statusDiv.style.color = 'red';
                    alert("Telegram Web App is NOT available!");
                }
            } catch (error) {
                console.error("Error sending data:", error);
                statusDiv.innerHTML = 'Status: Error - ' + error.message;
                statusDiv.style.color = 'red';
                alert("Error: " + error.message);
            }
        }
    </script>
</body>
</html>
