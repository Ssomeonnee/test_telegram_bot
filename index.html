<!DOCTYPE html>
<html>
<head>
    <title>Telegram Web App Test</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <button onclick="sendData()">Send Data to Bot</button>

    <script>
        // Инициализация Web App
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Telegram && window.Telegram.WebApp) {
                console.log("Telegram Web App is available!");
                console.log("WebApp version:", Telegram.WebApp.version);
                console.log("Platform:", Telegram.WebApp.platform);
                
                Telegram.WebApp.ready(); // Оповещаем Telegram, что Web App готов
                Telegram.WebApp.expand(); // Разворачиваем на весь экран
                
                // Обработчик закрытия Web App
                Telegram.WebApp.onEvent('viewportChanged', function(e) {
                    console.log('Viewport changed:', e);
                });
                
            } else {
                console.log("Telegram Web App is NOT available!");
                // Режим отладки вне Telegram
                window.Telegram = {
                    WebApp: {
                        sendData: function(data) {
                            console.log("Simulated sendData:", data);
                            // Симулируем закрытие Web App
                            setTimeout(function() {
                                if (confirm("Data sent. Close window?")) {
                                    window.close();
                                }
                            }, 1000);
                        },
                        ready: function() { console.log("Simulated ready"); },
                        close: function() { console.log("Simulated close"); }
                    }
                };
            }
        });

        function sendData() {
            try {
                if (window.Telegram && window.Telegram.WebApp) {
                    const data = { 
                        message: "Hello from Web App!",
                        timestamp: new Date().toISOString()
                    };
                    
                    console.log("Sending data:", data);
                    
                    // Отправляем данные
                    Telegram.WebApp.sendData(JSON.stringify(data));
                    
                    // Закрываем Web App после отправки
                    setTimeout(function() {
                        Telegram.WebApp.close();
                    }, 500);
                    
                } else {
                    alert("Telegram Web App is NOT available!");
                }
            } catch (error) {
                console.error("Error sending data:", error);
                alert("Error: " + error.message);
            }
        }
    </script>
</body>
</html>
