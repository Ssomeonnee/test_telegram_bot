<!DOCTYPE html>
<html>
<head>
    <title>Telegram Web App Test</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <button onclick="sendData()">Send Data to Bot</button>

    <script>
        // Инициализация Web App
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Telegram && window.Telegram.WebApp) {
                console.log("Telegram Web App is available!");
                console.log("WebApp version:", Telegram.WebApp.version);
                console.log("Platform:", Telegram.WebApp.platform);
                console.log("InitData:", Telegram.WebApp.initData);
                console.log("InitDataUnsafe:", Telegram.WebApp.initDataUnsafe);
                
                Telegram.WebApp.ready();
                Telegram.WebApp.expand();
                
            } else {
                console.log("Telegram Web App is NOT available!");
                // Режим отладки вне Telegram
                window.Telegram = {
                    WebApp: {
                        sendData: function(data) {
                            console.log("Simulated sendData:", data);
                            alert("Data would be sent: " + data);
                        },
                        ready: function() { console.log("Simulated ready"); },
                        close: function() { console.log("Simulated close"); }
                    }
                };
            }
        });

        function sendData() {
            try {
                if (window.Telegram && window.Telegram.WebApp) {
                    const data = { 
                        message: "Hello from Web App!",
                        timestamp: new Date().toISOString()
                    };
                    
                    console.log("Sending data:", data);
                    
                    // Отправляем данные
                    Telegram.WebApp.sendData(JSON.stringify(data));
                    
                    console.log("Data sent successfully");
                    
                    // НЕ закрываем Web App сразу - пусть пользователь сам закроет
                    // или закроется автоматически через некоторое время
                    
                } else {
                    alert("Telegram Web App is NOT available!");
                }
            } catch (error) {
                console.error("Error sending data:", error);
                alert("Error: " + error.message);
            }
        }
    </script>
</body>
</html>
